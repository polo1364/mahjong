<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>éº»å°‡ï½œç›´å¼æ‰‹æ©Ÿå †ç–Šç‰ˆï¼ˆå…¨æ–°ä½ˆå±€ï¼‰</title>
  <meta name="color-scheme" content="dark">
  <style>
    :root{
      --safeT: env(safe-area-inset-top);
      --safeB: env(safe-area-inset-bottom);
      --bg: #062a55;
      --panel: #0a3b75;
      --panel-2: #0b3a6a;
      --muted: #8aa7c7;
      --acc: #8fe06b;
      --warn: #ffd05e;
      --tileW: clamp(28px, 8.8vw, 44px);
      --tileH: calc(var(--tileW) * 1.4);
      --radius: 12px;
      --gap: 10px;
      --shadow: 0 4px 16px rgba(0,0,0,.18);
      --btnH: 44px;
      --ctrlH: 92px;
      --font: system-ui, -apple-system, "PingFang TC", "Noto Sans TC", "Noto Sans CJK TC", "Microsoft JhengHei", sans-serif;
    }
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0; background: radial-gradient(120% 90% at 50% 0%, #0a3b75 0%, #062a55 60%, #052349 100%);
      color:#eaf3ff; font-family: var(--font);
      overscroll-behavior-y: none;
    }
    .landscape-gate{ display:none; position:fixed; inset:0; background:#031a36; color:#bcd3ef; align-items:center; justify-content:center; font-size:15px; z-index:2000; }
    @media (orientation:landscape){
      .landscape-gate{ display:flex; }
      #app{ filter: blur(2px); pointer-events:none; }
    }
    #app{ min-height:100%; padding: calc(var(--safeT) + 6px) 10px calc(var(--ctrlH) + var(--safeB) + 12px); }
    .row{ display:grid; gap: var(--gap); }
    .grid-2{ grid-template-columns: 1fr 38%; align-items: start; }
    @media (max-width:360px){ .grid-2{ grid-template-columns: 1fr 40%; } }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 10px;
    }
    .card-title{
      display:flex; align-items:center; gap:8px; margin-bottom:6px;
      font-size:13px; letter-spacing:.6px; color: var(--acc); font-weight:600;
    }
    .chip{ font-size:11px; padding:3px 8px; border-radius:999px; background:rgba(255,255,255,.08); color:#cfe5ff; }
    .muted{ color:var(--muted); }
    .mono{ font-variant-numeric: tabular-nums; font-feature-settings: "tnum"; }
    .log{ max-height: 126px; overflow:auto; border-radius: 8px; background: rgba(0,0,0,.18); padding:8px; }
    .log-item{ display:flex; align-items:center; gap:6px; padding:3px 0; font-size:13px; }
    .log-item .tag{ font-size:11px; padding:1px 6px; border-radius:6px; background: rgba(255,255,255,.08); color:#dff0ff; }
    .round{ display:grid; gap:6px; }
    .round .rowline{ display:flex; flex-wrap:wrap; gap:6px; }
    .badge{ background:#0f4b91; color:#e7f4ff; padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid rgba(255,255,255,.08); }
    .hand{ display:flex; gap:6px; overflow-x:auto; -webkit-overflow-scrolling:touch; padding:6px 4px; scroll-snap-type: x mandatory; background: rgba(255,255,255,.04); border-radius: 10px; }
    .hand::-webkit-scrollbar{ display:none; }
    .tile{
      width: var(--tileW); height: var(--tileH);
      background:linear-gradient(180deg, #ffffff, #f2f6ff);
      border-radius: 6px; color:#102a5e; display:flex; align-items:center; justify-content:center;
      font-weight:700; font-size: calc(var(--tileW) * .9 * .4 + 9px);
      box-shadow: 0 1px 0 rgba(0,0,0,.35), 0 6px 10px rgba(0,0,0,.15);
      border:1px solid #d8e6ff;
      user-select:none;
      scroll-snap-align: start;
      position:relative;
    }
    .tile.suit-wan{ color:#e14b4b; }
    .tile.suit-tong{ color:#1976d2; }
    .tile.suit-tiao{ color:#2eb972; }
    .tile.suit-zhong{ color:#e14b4b; }
    .tile.suit-fa{ color:#1aa563; }
    .tile.suit-bai{ color:#777; }
    .tile.active{ outline:3px solid #ffce66; }
    .tile.small{ transform: scale(.92); transform-origin: bottom center; }
    .players{ display:grid; gap:12px; }
    .player{ padding:10px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.06); box-shadow: var(--shadow); }
    .player-head{ display:flex; align-items:center; justify-content:space-between; gap:6px; }
    .p-meta{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .seat{ background:#164b9a; color:#fff; border-radius:10px; padding:3px 8px; font-weight:700; }
    .banker{ background:#f5c04b; color:#402; border-radius:8px; padding:1px 6px; font-weight:800; }
    .pile{ display:grid; gap:6px; margin-top:8px; }
    .pile .title{ font-size:12px; color:#9ec3ff; margin: 2px 0 4px 2px; }
    .pile .rack{ display:flex; flex-wrap:wrap; gap:6px; min-height: var(--tileH); padding-bottom:2px; }
    .controls{ position:fixed; left:0; right:0; bottom:0; z-index:1000; background: linear-gradient(180deg, rgba(0,30,80,.1), rgba(0,30,80,.95)); padding: 8px 10px calc(8px + var(--safeB)); border-top: 1px solid rgba(255,255,255,.08); backdrop-filter: blur(8px); }
    .ctrl-row{ display:flex; gap:8px; overflow-x:auto; -webkit-overflow-scrolling:touch; }
    .btn{ height: var(--btnH); padding: 0 14px; background: #0e4fa1; color:#eaf3ff; border:1px solid rgba(255,255,255,.14); border-radius: 12px; box-shadow: var(--shadow); font-size:14px; font-weight:700; display:flex; align-items:center; justify-content:center; gap:6px; white-space:nowrap; user-select:none; }
    .btn.warn{ background:#f1b93f; color:#2a1a00; border-color:#f7d37f; }
    .btn.ghost{ background: rgba(255,255,255,.06); color:#dfeeff; }
    .btn:disabled{ opacity:.45; filter: grayscale(.3); }
    .topbar{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:10px; }
    .chip-pill{ background:#0b447f; border:1px solid rgba(255,255,255,.12); border-radius:1000px; color:#e5f0ff; padding:8px 12px; font-size:13px; display:flex; align-items:center; gap:8px; }
    .topbar .btn-start{ margin-left:auto; }
    .sr{ position:absolute; width:1px; height:1px; overflow:hidden; clip: rect(0 0 0 0); white-space:nowrap; }
  </style>
</head>
<body>
  <div class="landscape-gate">æ­¤é ç‚ºç›´å¼æ‰‹æ©Ÿå°ˆç”¨ï¼Œè«‹æ—‹è½‰ç‚ºç›´å¼ä»¥ç²å¾—æœ€ä½³é«”é©—ã€‚</div>
  <main id="app">
    <div class="topbar">
      <div class="chip-pill">å°ç£ 16 å¼µéº»å°‡ï¼ˆå–®æ©Ÿï¼‰</div>
      <div class="chip-pill">å•Ÿç”¨é‡‘ç‰Œï¼š<span id="opt-gold">âœ”</span></div>
      <div class="chip-pill">åº• 2000ï¼æ¯å° 1000</div>
      <button class="btn warn btn-start" id="btn-new">é–‹å§‹æ–°å±€</button>
    </div>
    <div class="row grid-2">
      <section class="card">
        <div class="card-title">æˆ°æ³</div>
        <div class="log" id="log"></div>
      </section>
      <aside class="card">
        <div class="card-title">ç‰Œå±€è³‡è¨Š</div>
        <div class="round">
          <div class="rowline">
            <div class="badge">å ´é¢¨ï¼š<span id="round-wind">æ±</span></div>
            <div class="badge">åœˆæ•¸ï¼š<span id="round-idx">1</span></div>
            <div class="badge">èŠå®¶ï¼š<span id="round-banker">æ±</span></div>
          </div>
          <div class="rowline">
            <div class="badge">å‰©é¤˜ï¼š<span id="tiles-left">70</span> å¼µ</div>
            <div class="badge">é‡‘ç‰Œï¼š<span id="gold-tile">ç„¡</span></div>
          </div>
          <div class="rowline">
            <div class="badge">éª°å­ï¼š<span id="dice">3ï¼‹4</span></div>
          </div>
        </div>
      </aside>
    </div>
    <section class="card">
      <div class="card-title">ä½ çš„æ‰‹ç‰Œ</div>
      <div class="hand" id="hand" aria-label="ä½ çš„æ‰‹ç‰Œï¼ˆå¯å·¦å³æ»‘å‹•ï¼‰"></div>
    </section>
    <section class="players" id="players"></section>
  </main>
  <footer class="controls" aria-label="è¡Œå‹•æ“ä½œåˆ—">
    <div class="ctrl-row" id="ctrl-actions">
      <button class="btn warn" data-action="hu">èƒ¡ç‰Œ</button>
      <button class="btn" data-action="chi">åƒ</button>
      <button class="btn" data-action="peng">ç¢°</button>
      <button class="btn" data-action="gang">æ§“</button>
      <button class="btn ghost" data-action="ting">è½</button>
      <button class="btn ghost" data-action="pass">é</button>
    </div>
  </footer>
  <script>
  ;(function(){
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const suitClass = (t)=>{
      if(/[è¬]/.test(t)) return 'suit-wan';
      if(/[ç­’]/.test(t)) return 'suit-tong';
      if(/[æ¢]/.test(t)) return 'suit-tiao';
      if(/[ä¸­]/.test(t)) return 'suit-zhong';
      if(/[ç™¼]/.test(t)) return 'suit-fa';
      if(/[ç™½]/.test(t)) return 'suit-bai';
      return '';
    };
    function renderTile(txt, small=false){
      const el = document.createElement('div');
      el.className = 'tile ' + suitClass(txt) + (small ? ' small' : '');
      el.textContent = txt;
      el.setAttribute('role', 'button');
      el.setAttribute('tabindex', '0');
      el.dataset.tile = txt;
      el.addEventListener('click', ()=> MobileUI._onTile && MobileUI._onTile(txt));
      return el;
    }
    function renderLog(items){
      const log = $('#log'); log.innerHTML = '';
      items.slice(-20).forEach(it=>{
        const row = document.createElement('div');
        row.className = 'log-item';
        const tag = document.createElement('span'); tag.className='tag'; tag.textContent = it.who;
        const text = document.createElement('span'); text.textContent = it.msg;
        row.appendChild(tag); row.appendChild(text);
        log.appendChild(row);
      });
      log.scrollTop = log.scrollHeight;
    }
    function renderRound(r){
      $('#round-wind').textContent = r.wind;
      $('#round-idx').textContent = r.round;
      $('#round-banker').textContent = r.banker;
      $('#tiles-left').textContent = r.left;
      $('#gold-tile').textContent = r.gold || 'ç„¡';
      $('#dice').textContent = r.dice.join('ï¼‹');
    }
    function renderHand(tiles){
      const hand = $('#hand'); hand.innerHTML = '';
      tiles.forEach(t=> hand.appendChild(renderTile(t)));
    }
    function playerHeader(p){
      const wrap = document.createElement('div'); wrap.className='player';
      const head = document.createElement('div'); head.className='player-head';
      const meta = document.createElement('div'); meta.className='p-meta';
      const name = document.createElement('div'); name.className='chip-pill'; name.textContent = p.name || ('ç©å®¶ ' + p.seat);
      const seat = document.createElement('div'); seat.className='seat'; seat.textContent = p.seat;
      meta.appendChild(name); meta.appendChild(seat);
      if (p.banker) { const b = document.createElement('div'); b.className='banker'; b.textContent='èŠ'; meta.appendChild(b); }
      const stat = document.createElement('div'); stat.className='chip-pill mono'; stat.textContent = 'ğŸ’° ' + (p.score ?? 0).toLocaleString();
      const left = document.createElement('div'); left.className='chip-pill mono'; left.textContent = 'ğŸ€„ ' + (p.tiles ?? 0) + ' å¼µ';
      head.appendChild(meta); head.appendChild(stat); head.appendChild(left);
      wrap.appendChild(head);
      const pile = document.createElement('div'); pile.className='pile';
      const dTitle = document.createElement('div'); dTitle.className='title'; dTitle.textContent = 'æ¨ç‰Œ'; pile.appendChild(dTitle);
      const disc = document.createElement('div'); disc.className='rack';
      (p.discards || []).forEach(t=> disc.appendChild(renderTile(t, true)));
      pile.appendChild(disc);
      const mTitle = document.createElement('div'); mTitle.className='title'; mTitle.textContent = 'å‰¯éœ²'; pile.appendChild(mTitle);
      const meld = document.createElement('div'); meld.className='rack';
      (p.melds || []).forEach(group=>{
        const g = document.createElement('div'); g.style.display='flex'; g.style.gap='4px';
        group.forEach(t=> g.appendChild(renderTile(t, true)));
        meld.appendChild(g);
      });
      pile.appendChild(meld);
      wrap.appendChild(pile);
      return wrap;
    }
    function renderPlayers(list){
      const root = $('#players'); root.innerHTML='';
      const order = ['æ±','å—','è¥¿','åŒ—'];
      const lookup = new Map(list.map(p=>[p.seat,p]));
      order.forEach(seat=>{
        const p = lookup.get(seat); if(!p) return;
        root.appendChild(playerHeader(p));
      });
    }
    function setActions(actions){
      $$('#ctrl-actions .btn').forEach(b=>{
        const a = b.dataset.action;
        const ena = (actions && a in actions) ? !!actions[a] : true;
        b.disabled = !ena;
      });
    }
    $('#btn-new').addEventListener('click', ()=>{
      MobileUI._onNew && MobileUI._onNew();
    });
    window.MobileUI = {
      setState(state){
        if(state.round) renderRound(state.round);
        if(state.log) renderLog(state.log);
        if(state.you && state.you.hand) renderHand(state.you.hand);
        if(state.players) renderPlayers(state.players);
        if(state.actions) setActions(state.actions);
      },
      updateActions: setActions,
      onTileTap(fn){ this._onTile = fn; },
      onAction(fn){
        $$('#ctrl-actions .btn').forEach(b=>{
          b.onclick = ()=> fn(b.dataset.action);
        });
      },
      onStart(fn){ this._onNew = fn; }
    };
    const demo = {
      round: { wind:'æ±', round:1, banker:'æ±', left:54, gold:'8 ç­’', dice:[3,4] },
      log: [
        {who:'ç³»çµ±', msg:'æ´—ç‰Œå®Œæˆï¼ŒèŠå®¶ç‚º æ±ã€‚'},
        {who:'ä½ ', msg:'æ‘¸åˆ° 5 ç­’'},
        {who:'å°ç¾', msg:'æ‰“å‡º 9 è¬'},
      ],
      you: { hand:['1è¬','3è¬','3è¬','4è¬','6è¬','1ç­’','2ç­’','9ç­’','2æ¢','2æ¢','4æ¢','6æ¢','å—','å—'] },
      players: [
        {seat:'æ±', name:'ä½ ', banker:true, score:100000, tiles:17, discards:['9è¬'], melds:[['æ±','æ±','æ±']]},
        {seat:'å—', name:'å°ç¾', score:100000, tiles:16, discards:['1æ¢','9ç­’'], melds:[]},
        {seat:'è¥¿', name:'é˜¿èŠ¬', score:100000, tiles:16, discards:['8æ¢'], melds:[['1è¬','2è¬','3è¬']]},
        {seat:'åŒ—', name:'å»ºåœ‹', score:100000, tiles:16, discards:['ç™½'], melds:[]},
      ],
      actions: {hu:false, chi:['1-2-3æ¢'], peng:true, gang:true, ting:false, pass:true}
    };
    MobileUI.setState(demo);
    MobileUI.onTileTap((t)=>console.log('é»äº†æ‰‹ç‰Œ', t));
    MobileUI.onAction((a)=>console.log('é»äº†å‹•ä½œ', a));
    MobileUI.onStart(()=>console.log('é–‹å§‹æ–°å±€'));
  })();
  </script>
</body>
</html>
